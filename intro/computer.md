![cover](https://img1.doubanio.com/view/subject/l/public/s28079818.jpg)

    作者: [日] 矢泽久雄 
    出版社: 人民邮电出版社
    译者: 胡屹 
    出版年: 2015-5
    页数: 272
    定价: 39.00元
    装帧: 平装
    丛书: 图灵程序设计丛书
    ISBN: 9787115392275

[豆瓣链接](https://book.douban.com/subject/26397183/)

- [第1章 计算机的三大原则](#%e7%ac%ac1%e7%ab%a0-%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%9a%84%e4%b8%89%e5%a4%a7%e5%8e%9f%e5%88%99)
  - [1.1 计算机的三个根本性原则](#11-%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%9a%84%e4%b8%89%e4%b8%aa%e6%a0%b9%e6%9c%ac%e6%80%a7%e5%8e%9f%e5%88%99)
  - [1.2 输入、运算、输出是硬件的基础](#12-%e8%be%93%e5%85%a5%e8%bf%90%e7%ae%97%e8%be%93%e5%87%ba%e6%98%af%e7%a1%ac%e4%bb%b6%e7%9a%84%e5%9f%ba%e7%a1%80)
  - [1.3 软件是指令和数据的集合](#13-%e8%bd%af%e4%bb%b6%e6%98%af%e6%8c%87%e4%bb%a4%e5%92%8c%e6%95%b0%e6%8d%ae%e7%9a%84%e9%9b%86%e5%90%88)
  - [1.7 稍微预习一下第2章](#17-%e7%a8%8d%e5%be%ae%e9%a2%84%e4%b9%a0%e4%b8%80%e4%b8%8b%e7%ac%ac2%e7%ab%a0)
- [第2章 试着制造一台计算机吧](#%e7%ac%ac2%e7%ab%a0-%e8%af%95%e7%9d%80%e5%88%b6%e9%80%a0%e4%b8%80%e5%8f%b0%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%90%a7)
  - [2.1 制作微型计算机所必需的元件](#21-%e5%88%b6%e4%bd%9c%e5%be%ae%e5%9e%8b%e8%ae%a1%e7%ae%97%e6%9c%ba%e6%89%80%e5%bf%85%e9%9c%80%e7%9a%84%e5%85%83%e4%bb%b6)
  - [2.2 电路图的读法](#22-%e7%94%b5%e8%b7%af%e5%9b%be%e7%9a%84%e8%af%bb%e6%b3%95)
  - [2.3 连接电源、数据和地址总线](#23-%e8%bf%9e%e6%8e%a5%e7%94%b5%e6%ba%90%e6%95%b0%e6%8d%ae%e5%92%8c%e5%9c%b0%e5%9d%80%e6%80%bb%e7%ba%bf)
  - [2.4 连接I/O](#24-%e8%bf%9e%e6%8e%a5io)
  - [2.5 连接时钟信号](#25-%e8%bf%9e%e6%8e%a5%e6%97%b6%e9%92%9f%e4%bf%a1%e5%8f%b7)
  - [2.7 连接剩余的控制引脚](#27-%e8%bf%9e%e6%8e%a5%e5%89%a9%e4%bd%99%e7%9a%84%e6%8e%a7%e5%88%b6%e5%bc%95%e8%84%9a)
  - [2.10 输入测试程序并进行调试](#210-%e8%be%93%e5%85%a5%e6%b5%8b%e8%af%95%e7%a8%8b%e5%ba%8f%e5%b9%b6%e8%bf%9b%e8%a1%8c%e8%b0%83%e8%af%95)
- [第3章 体验一次手工汇编](#%e7%ac%ac3%e7%ab%a0-%e4%bd%93%e9%aa%8c%e4%b8%80%e6%ac%a1%e6%89%8b%e5%b7%a5%e6%b1%87%e7%bc%96)
  - [3.1 从程序员的角度看硬件](#31-%e4%bb%8e%e7%a8%8b%e5%ba%8f%e5%91%98%e7%9a%84%e8%a7%92%e5%ba%a6%e7%9c%8b%e7%a1%ac%e4%bb%b6)
  - [3.2 机器语言和汇编语言](#32-%e6%9c%ba%e5%99%a8%e8%af%ad%e8%a8%80%e5%92%8c%e6%b1%87%e7%bc%96%e8%af%ad%e8%a8%80)
  - [3.3 Z80 CPU的寄存器结构](#33-z80-cpu%e7%9a%84%e5%af%84%e5%ad%98%e5%99%a8%e7%bb%93%e6%9e%84)
  - [3.4 追踪程序的运行过程](#34-%e8%bf%bd%e8%b8%aa%e7%a8%8b%e5%ba%8f%e7%9a%84%e8%bf%90%e8%a1%8c%e8%bf%87%e7%a8%8b)
  - [3.5 尝试手工汇编](#35-%e5%b0%9d%e8%af%95%e6%89%8b%e5%b7%a5%e6%b1%87%e7%bc%96)
  - [3.6 尝试估算程序的执行时间](#36-%e5%b0%9d%e8%af%95%e4%bc%b0%e7%ae%97%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%89%a7%e8%a1%8c%e6%97%b6%e9%97%b4)
- [第4章 程序像河水一样流动着](#%e7%ac%ac4%e7%ab%a0-%e7%a8%8b%e5%ba%8f%e5%83%8f%e6%b2%b3%e6%b0%b4%e4%b8%80%e6%a0%b7%e6%b5%81%e5%8a%a8%e7%9d%80)
  - [4.1 程序的流程分为三种](#41-%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%b5%81%e7%a8%8b%e5%88%86%e4%b8%ba%e4%b8%89%e7%a7%8d)
  - [4.2 用流程图表示程序的流程](#42-%e7%94%a8%e6%b5%81%e7%a8%8b%e5%9b%be%e8%a1%a8%e7%a4%ba%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%b5%81%e7%a8%8b)
  - [4.3 表示循环程序块的“帽子”和“短裤”](#43-%e8%a1%a8%e7%a4%ba%e5%be%aa%e7%8e%af%e7%a8%8b%e5%ba%8f%e5%9d%97%e7%9a%84%e5%b8%bd%e5%ad%90%e5%92%8c%e7%9f%ad%e8%a3%a4)
  - [4.4 结构化程序设计](#44-%e7%bb%93%e6%9e%84%e5%8c%96%e7%a8%8b%e5%ba%8f%e8%ae%be%e8%ae%a1)
  - [4.5 画流程图来思考算法](#45-%e7%94%bb%e6%b5%81%e7%a8%8b%e5%9b%be%e6%9d%a5%e6%80%9d%e8%80%83%e7%ae%97%e6%b3%95)
  - [4.6 特殊的程序流程-中断处理](#46-%e7%89%b9%e6%ae%8a%e7%9a%84%e7%a8%8b%e5%ba%8f%e6%b5%81%e7%a8%8b-%e4%b8%ad%e6%96%ad%e5%a4%84%e7%90%86)
  - [4.7 特殊的程序流程-事件驱动](#47-%e7%89%b9%e6%ae%8a%e7%9a%84%e7%a8%8b%e5%ba%8f%e6%b5%81%e7%a8%8b-%e4%ba%8b%e4%bb%b6%e9%a9%b1%e5%8a%a8)
- [第5章 与算法成为好朋友的七个要点](#%e7%ac%ac5%e7%ab%a0-%e4%b8%8e%e7%ae%97%e6%b3%95%e6%88%90%e4%b8%ba%e5%a5%bd%e6%9c%8b%e5%8f%8b%e7%9a%84%e4%b8%83%e4%b8%aa%e8%a6%81%e7%82%b9)
  - [要点1：算法中解决问题的步骤是明确且有限的](#%e8%a6%81%e7%82%b91%e7%ae%97%e6%b3%95%e4%b8%ad%e8%a7%a3%e5%86%b3%e9%97%ae%e9%a2%98%e7%9a%84%e6%ad%a5%e9%aa%a4%e6%98%af%e6%98%8e%e7%a1%ae%e4%b8%94%e6%9c%89%e9%99%90%e7%9a%84)
  - [要点2：计算机不靠直觉而是机械地解决问题](#%e8%a6%81%e7%82%b92%e8%ae%a1%e7%ae%97%e6%9c%ba%e4%b8%8d%e9%9d%a0%e7%9b%b4%e8%a7%89%e8%80%8c%e6%98%af%e6%9c%ba%e6%a2%b0%e5%9c%b0%e8%a7%a3%e5%86%b3%e9%97%ae%e9%a2%98)
  - [要点3：了解并应用典型算法](#%e8%a6%81%e7%82%b93%e4%ba%86%e8%a7%a3%e5%b9%b6%e5%ba%94%e7%94%a8%e5%85%b8%e5%9e%8b%e7%ae%97%e6%b3%95)
- [第6章 与数据结构成为好朋友的七个要点](#%e7%ac%ac6%e7%ab%a0-%e4%b8%8e%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e6%88%90%e4%b8%ba%e5%a5%bd%e6%9c%8b%e5%8f%8b%e7%9a%84%e4%b8%83%e4%b8%aa%e8%a6%81%e7%82%b9)
  - [要点1：了解内存和变量的关系](#%e8%a6%81%e7%82%b91%e4%ba%86%e8%a7%a3%e5%86%85%e5%ad%98%e5%92%8c%e5%8f%98%e9%87%8f%e7%9a%84%e5%85%b3%e7%b3%bb)
  - [要点2：了解作为数据结构基础的数组](#%e8%a6%81%e7%82%b92%e4%ba%86%e8%a7%a3%e4%bd%9c%e4%b8%ba%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e5%9f%ba%e7%a1%80%e7%9a%84%e6%95%b0%e7%bb%84)
  - [要点3：了解数组的应用 – 作为典型算法的数据结构](#%e8%a6%81%e7%82%b93%e4%ba%86%e8%a7%a3%e6%95%b0%e7%bb%84%e7%9a%84%e5%ba%94%e7%94%a8-%e2%80%93-%e4%bd%9c%e4%b8%ba%e5%85%b8%e5%9e%8b%e7%ae%97%e6%b3%95%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84)
  - [要点4：了解并掌握典型数据结构的类型和概念](#%e8%a6%81%e7%82%b94%e4%ba%86%e8%a7%a3%e5%b9%b6%e6%8e%8c%e6%8f%a1%e5%85%b8%e5%9e%8b%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e7%9a%84%e7%b1%bb%e5%9e%8b%e5%92%8c%e6%a6%82%e5%bf%b5)
  - [要点5：了解栈和队列的实现方法](#%e8%a6%81%e7%82%b95%e4%ba%86%e8%a7%a3%e6%a0%88%e5%92%8c%e9%98%9f%e5%88%97%e7%9a%84%e5%ae%9e%e7%8e%b0%e6%96%b9%e6%b3%95)
  - [要点6：了解结构体的组成](#%e8%a6%81%e7%82%b96%e4%ba%86%e8%a7%a3%e7%bb%93%e6%9e%84%e4%bd%93%e7%9a%84%e7%bb%84%e6%88%90)

## 第1章 计算机的三大原则
### 1.1 计算机的三个根本性原则
下面开始介绍计算机的三大原则

1. 计算机是执行输入、运算、输出的机器
2. 程序是指令和数据的集合
3. 计算机的处理方式有时与人们的思维习惯不同

### 1.2 输入、运算、输出是硬件的基础
计算机的硬件由大量的`IC`（Integrated Circuit，集成电路）组成（如图1.1所示）。每块IC上都带有许多`引脚`，这些引脚有的用于输入，有的用于输出。IC会在内部对外部输入的信息进行运算，并把运算结果输出到外部。

图1.1 IC的引脚有些用于输入，有些用于输出

![](computer1.png)

### 1.3 软件是指令和数据的集合
- 所谓`程序`，是指令和数据的集合。
- 所谓`指令`，就是控制计算机进行输入、运算、输出的命令。

在程序设计中，会为一组指令赋予一个名字，称之为`“函数”`。

程序中的`数据`分为两类，一类是作为指令执行对象的输入数据；一类是从指令的执行结果得到的输出数据。在编程时程序员会为数据赋予名字，称其为`“变量”`。

    output=operate(input)

代码清单1.1 C语言的程序示例片段

```c
int a, b, c;

a=10;
b=20;
c=Average(a,b);
```

- C语言中要在每条指令的末尾写一个分号（；）。
- 等号是赋值给变量的指令。

所谓`编译`就是把用C语言等编程语言编写的文件（源文件）转换成用机器语言（原生代码）文件。

代码清单1.2 机器语言的程序示例

```
C7 45 FC 01 00 00 00 C7 45 F8 02 00 00 00 8B 45
F8 50 8B 4D FC 51 E8 82 FF FF FF 83 C4 08 89 45
F4 8B 55 F4 52 68 1C 30 42 00 E8 B9 03 00 00 83
```

第一个数值C7表示指令，第二个数值45表示数据。

### 1.7 稍微预习一下第2章
图1.4 计算机硬件的组成要素

![](computer2.png)

计算机内部主要由被称为IC的元件组成（主要的3种）：CPU（处理器）、内存以及I/O。

- `CPU`是计算机的大脑，在其内部可对数据执行运算并控制内存和I/O。
- `内存`用于存储指令和数据。
- `I/O`负责把键盘、鼠标、显示等周边设备和主机连接在一起，实现数据的输入和输出。

只要用电路把CPU、内存以及I/O上的`引脚`相互连接起来，为每块IC提供电源，再为CPU提供时钟信号，硬件上的计算机就组装起来了。

所谓`时钟信号`，就是由内含晶振（一种利用石英晶体（又称水晶）的压电效应产生高精度振荡频率的电子元件）的、被称为时钟发生器的元件发出的滴答滴答的电信号。

## 第2章 试着制造一台计算机吧
### 2.1 制作微型计算机所必需的元件
为了驱动CPU运转，称为“时钟信号”的电信号是必不可少的。这种电信号就好像带有一个时钟，滴答滴答地每隔一定时间就变换一次电压的高低（如图2.2所示）。

图2.2 时钟信号的波形图

![](computer3.png)

输出时钟信号的元件叫“时钟发生器”。时钟发生器中带有晶振，根据其自身的频率（振动的次数）产生时钟信号。时钟信号的频率可以衡量CPU的运转速度，这里使用的是2.5MHz的时钟发生器(2.5MHz（兆赫兹）的话就是2.5*100万=250万次/秒)。

通过拨动`指拨开关来`输入程序，指拨开关是一种由8个开关并排连在一起构成的元件（如照片2.1a所示）。输出程序执行结果的装置是8个`LED（发光二极管）`。

`电阻`是用于阻碍电流流动、降低电压值的元件。

照片2.1 指拨开关和集成电阻

![](computer4.png)

### 2.2 电路图的读法
本次制作的微型计算机工作在+5V的直流电下。

图2.4 电源的表示方法

![](computer5.png)

IC的引脚（所谓引脚就是IC边缘露出来的像蜈蚣腿一样的部分）按逆时针方向依次带有一个从1开始递增的序号，数引脚序号时，要先把表示正方向的标志，如半圆形缺口朝向左侧，举例来说，带有14个引脚的7404，其引脚序号如图2.5所示

图2.5 如何数IC的引脚序号

![](computer6.png)

画图时，在引脚的旁边写上引脚的序号，在表示IC的矩形符号中写上表明该引脚作用的代号，代号就是像RD（Read）表示执行读取操作，WR（Write）表示执行写入操作这样的代表了某种操作的符号。

### 2.3 连接电源、数据和地址总线
微型计算机所使用的IC属于数字IC。在数字IC中，每个引脚上的电压要么是0V，要么是+5V，通过这两个电压与其他的IC进行电信号的收发。

只要想成0V表示数字0，+5V表示数字1，那么数字IC就是在用二进制数的形式收发信息。

为了指定输入输出数据时的源或目的地，CPU上备有“地址总线引脚”。Z80 CPU的地址总线引脚有16个，用代号A0-A15表示，其中的A表示Address（地址）,0-15表示一个16位的二进制数中各个数字的位置，0对应最后一位，15对应第一位。16个地址总线引脚所能指定的地址共有65536个，用二进制数表示的话就是0000000000000000-1111111111111111。因此，Z80 CPU可以指定65536个数据存储单元（内存存储单元或I/O地址），进行信息的输入输出。

Z80 CPU的数据总线引脚共有8个，用代号D0-D7表示，D表示Data（数据），数字0-7与地址总线引脚代号的规则相同，也表示二进制数中各个数字的位置，Z80 CPU可以一次性地输入输出8比特的数据。

作为内存的TC5517上也有地址总线引脚（A0-A10）和数据总线引脚（D0-D7）。这些引脚需要同Z80 CPU上带有相同代号的引脚相连。一块TC5517上可以存储2048个8比特的数据（如图2.6所示）。

图2.6 TC5517的内部构造

![](computer7.png)

### 2.4 连接I/O
寄存器是位于CPU和I/O中的数据存储器，Z80 PIO上共有4个`寄存器`，2个用于设定PIO本身的功能，2个用于存储与外部设备进行输入输出的数据。

这4个寄存器分别叫做端口A控制、端口A数据、端口B控制和端口B数据。所谓`端口`就是I/O与外部设备之间输入输出数据的场所。

图2.7 Z80 PIO内部结构

![](computer8.png)

### 2.5 连接时钟信号
Z80 CPU和Z80 PIO的运转离不开时钟信号。为了传输时钟信号，就需要把时钟发生器的8号引脚和Z80 CPU的CLK（CLK即Clock，时钟）引脚、Z80 PIO的CLK引脚分别连接起来。时钟发生器的8号引脚与+5V之间的电阻用于清理时钟信号。

### 2.7 连接剩余的控制引脚
CPU、内存、I/O中不但有`地址总线引脚`、`数据总线引脚`，还有其他引脚，通常把这些引脚统称为`“控制引脚”`。

INT引脚是用于从Z80 PIO向Z80 CPU发出中断请求的引脚。所谓`中断`就是让CPU根据外部输入的数据执行特定的程序。

RESET引脚上的值先设置为0再还原成1，CPU就会被重置，重新从内存0号地址上的指令开始顺序向下执行。

`总线`是连接到CPU中数据引脚、地址引脚、控制引脚上的电路的统称。若将BUSRQ引脚的值设为0，则Z80 CPU从电路中`隔离`。当处于这种隔离状态时，就可以不通过CPU，手动地向内存写入程序了。像这样不经过CPU而直接从外部设备读写内存的行为叫`DMA`（Direct Memory Access，直接存储器访问）。

### 2.10 输入测试程序并进行调试
代码清单2.1展示了一段用机器语言编写的测试程序。程序是指令和数据的集合，表示指令或数据的数值为8比特为一个单位存储到内存中的。这段程序只实现了一个简单的功能，那就是通过拨动连接到Z80 PIO上的指拨开关控制LED的亮或灭。

代码清单2.1 用机器语言编写的测试程序

```
地址        程序

00000000    00111110
00000001    11001111
00000010    11010011
00000011    00000010
00000100    00111110
00000101    11111111
00000110    11010011
00000111    00000010
00001000    00111110
00001001    11001111
00001010    11010011
00001011    00000011
00001100    00111110
00001101    00000000
00001110    11010011
00001111    00000011
00010000    11011011
00010001    00000000
00010010    11010011
00010011    00000001
00010100    11000011
00010101    00010000
00010110    00000000
```

接通了微型计算机的电源后，请按下Z80 CPU上的DMA请求开关。在这个状态下，拨动用于输入内存程序和指定内存输入地址的两个指拨开关，

把代码清单2.1所示的程序一行接一行地输入内存。先来输入第一行代码，拨动用于指定地址的指拨开关，设定第一行代码所在的内存地址00000000，然后拨动用于输入程序的指拨开关，设定出程序代码00111110，再按下用于向内存写入程序的按键开关。接下来输入第二行代码，设定内存地址00000001，设定出程序代码11001111，再次按下按键开关。反复进行这三步操作，直到输入完程序代码的最后一行，所有的指令都输入完成后，按下用于重置CPU的按键开关，控制DMA请求的快动开关就会还原成关闭状态，与此同时程序也就运行起来了。

程序一旦运行起来，就可以用第3个指拨开关控制LED的亮与灭。只要拨动指拨开关，LED的亮灭就会随之改变。LED并不会只亮一下，而是一直亮着，时刻保持着指拨开关上的状态。

## 第3章 体验一次手工汇编
### 3.1 从程序员的角度看硬件
真正需要了解的硬件信息只有以下7种（如图3.1所示）:

图3.1 编写程序之前需要了解的硬件信息

![](computer9.png)

- CPU（处理器）信息
  - CPU的种类
  - 时钟信号的频率
- 内存信息
  - 地址空间
  - 每个地址中可以存储多少比特的信息
- I/O信息
  - I/O的种类
  - 地址空间
  - 连接着何种周边设备

`机器语言`就是处理器可以直接理解（与生俱来就能理解）的编程语言。机器语言有时也叫做原生代码（Native Code）。

所谓`时钟信号`的`频率`，就是由时钟发生器发送给CPU的电信号的频率。表示时钟信号频率的单位是MHz（兆赫兹=100万回/秒）。我们的微型计算机使用的是2.5MHz的时钟信号，时钟信号是在0和1两个数之间反复变换的电信号，通常把发出一次滴答的时间称为一个`时钟周期`。

在机器语言中，指令执行时所需的时钟周期数取决于指令的类型。程序员可以通过累加时钟周期数估算程序执行的时间。

每个`地址`都标示着一个内存中的数据存储单元，而这些地址所构成的范围就是内存的地址空间。在我们的微型计算机中，地址空间为0-255，每一个地址中可以存储8比特（1字节）的指令或数据。

所谓I/O的地址空间，是指用于指定I/O寄存器的地址范围。

在内存中，每个地址的功能都一样，既可用于存储指令又可用于存储数据。而I/O不同，地址编号不同（即寄存器的类型不同），功能也就不同。

### 3.2 机器语言和汇编语言
在机器语言程序中，虽然都是0和1的组合，但每个组合都是有特定含义的指令或数据。可是对人类来说，如果只看0和1的话，恐怕很难判断各个组合都表示什么。根据表示指令功能的英语单词起一个相似的昵称，并将这个昵称赋予给0和1的组合。这种类似英语单词的昵称叫做“助记符”，使用助记符的编程语言叫做`“汇编语言”`。

汇编语言的语法十分简单，以至于语法只有一个，即把“标签”“操作码（指令）”和“操作数（指令的对象）”并排写在一行上。

代码清单3.2 用汇编语言的代码表示代码清单3.1中的机器语言

标签 | 操作码 | 操作数
---|-----|----
- | LD | A,207
- | OUT | (2),A
- | LD | A,255
- | OUT | (2),A
- | LD | A,207
- | OUT | (3),A
- | LD | A,0
- | OUT | (3),A
LOOP: | IN | A,(0)
- | OUT | (1),A
- | JP | LOOP

- `标签`的作用是为该行代码对应的内存地址起一个名字。
- `操作码`就是表示“做什么”的指令。
- `操作数`表示的是指令执行的对象。

### 3.3 Z80 CPU的寄存器结构
与I/O的寄存器不同，CPU的寄存器不仅能存储数据，还具备对数据进行运算的能力。

图3.2 Z80 CPU的寄存器

![](computer10.png)

- A寄存器也叫做“累加器”
- F寄存器也叫做“标志寄存器”，用于存储运算结果的状态，比如是否发生了进位、数字大小的比较结果等
- PC寄存器也叫做“程序指针”，存储着指向CPU接下来要执行的指令的地址。PC寄存器的值会随着滴答滴答的时钟信号自动更新
- SP寄存器也叫做“栈顶指针”，用于在内存中创建一块称为“栈”的临时数据存储区域

### 3.4 追踪程序的运行过程
用汇编语言编写的程序是不能直接运行的，必须先转换成机器语言。机器语言是唯一一种CPU能直接理解的编程语言。汇编语言中的1条指令能转换成多少条机器语言取决于指令的种类及操作数的个数。

代码清单3.3 汇编语言与机器语言的对应关系

地址 | 机器语言 | 标签 | 操作码 | 操作数
---|------|----|-----|----
00000000 | 00111110 11001111 | LD | A,207
00000010 | 11010011 00000010 | OUT | (2),A
00000100 | 00111110 11111111 | LD | A,255
00000110 | 11010011 00000010 | OUT | (2),A
00001000 | 00111110 11001111 | LD | A,207
00001010 | 11010011 00000011 | OUT | (3),A
00001100 | 00111110 00000000 | LD | A,0
00001110 | 11010011 00000011 | OUT | (3),A
00010000 | 11011011 00000000 | LOOP:IN | A,(0)
00010010 | 11010011 00000001 | OUT | (1),A
00010100 | 11000011 00010000 00000000 | JP | LOOP

### 3.5 尝试手工汇编
表3.2 从助记符到机器语言的转换方法

助记符 | 机器语言 | 时钟周期数
----|------|------
LD A,num | 00111110 num | 7
OUT(num),A | 11010011 num | 11
IN A,(num) | 11011011 num | 11
JP num | 11000011 num | 10

### 3.6 尝试估算程序的执行时间
表3.2，找出执行每条汇编语言指令所需的时钟周期，然后把代码清单3.2中所用到的每条指令的时钟周期累加起来。于是可以算出到LOOP标签为止的8条指令共需要7+11+7+11+7+11+7+11=72个时钟周期；LOOP标签之后的3条指令需要11+11+10=32个时钟周期，因为微型计算机采用的是2.5MHz的晶振，也就是1秒可产生250万个时钟周期，所以 **每个时钟周期是1秒/250万=0.4微秒**。72个时钟周期就是72*0.4=28.8微秒，32个时钟周期就是12.8微秒，这段程序是用LED的亮或灭来表示指拨开关的开关状态，所以LOOP标签之后所执行的操作“输入、输出、跳转”每猜测可以反复执行1秒/12.8微秒/次=78125次。

## 第4章 程序像河水一样流动着
### 4.1 程序的流程分为三种
计算机的硬件系统由CPU、I/O和内存三部分构成。内存中存储着程序，也就是指令和数据。CPU配合着由时钟发生器发出的滴答滴答的时钟信号，从内存中读出指令，然后再依次对其进行解释和执行。

一个称为`PC（Program Counter，程序计数器）`的寄存器，负责存储内存地址，该地址指向下一条即将执行的指令，每解释执行完一条指令，PC寄存器的值就会自动被更新为下一条指令的地址。

图4.1 硬件上的程序流程（顺序执行）

![](computer11.png)

程序的流程总共有三种。

- `顺序执行`是按指令记录在内存中的先后顺序依次执行的一种流程。
- `循环`则是在程序的特定范围内反复执行若干次的一种流程。
- `条件分支`是根据若干个条件的成立与否，在程序的流程中产生若干个分支的一种流程。

### 4.2 用流程图表示程序的流程
图4.5 用流程图表示的顺序执行、条件分支、循环三种流程

![](computer12.png)

### 4.3 表示循环程序块的“帽子”和“短裤”
图4.6 表示循环的符号

![](computer14.png)

图4.7 循环中嵌套循环

![](computer15.png)

图4.8 从硬件上看循环的过程

![](computer13.png)

在这些高级语言中，程序员使用“程序块”表示循环而不是跳转指令。所谓`“程序块”`就是程序中代码的集合。程序中要被循环处理的部分，就是一种程序块。

图4.10 从硬件上看条件分支的过程

![](computer16.png)

### 4.4 结构化程序设计
结构化程序设计是由学者戴克斯特拉提倡的一种编程风格。所谓`结构化程序设计`就是“为了把程序编写的具备结构性，仅使用顺序结构、条件分支和循环表示程序的流程即可，而不再使用跳转指令”。(在很多高级语言中，还是提供了与机器语言中跳转指令相当的语句，例如VBScript中的GoTo语句。)

### 4.5 画流程图来思考算法
所谓`算法（Algorithm）`就是解决既定问题的步骤。

如果眼下待解决的问题是如何编写“石头剪刀布游戏”，那么就必须考虑如何把若干条指令组合起来并形成一个解决问题的流程。如果能够想出可以巧妙实现“石头剪刀布游戏”的流程，那么这个问题也就解决了，换言之算法也就实现了。

图4.12 “石头剪刀布游戏”的粗略流程图

![](computer17.png)

### 4.6 特殊的程序流程-中断处理
`中断处理`是指计算机使程序的流程突然跳转到程序中的特定地方，这样的地方被称为中断处理例程（Rountine）或是中断处理程序（Handler），而这种跳转是通过CPU所具备的硬件功能实现的。

在Z80 CPU中有INT和NMI两个引脚，它们可以接收从I/O设备发出的中断请求信号（INT引脚用于处理一般的中断请求。NMI引脚则用于即使CPU屏蔽了中断，也可在执行中的指令结束后立即响应中断请求的情况）。

以硬件形式连接到CPU上的I/O模块会发出中断请求信号，CPU根据该信号执行相应的中断处理程序。

图4.14 中断请求信号由连接到周边设备上的I/O发出

![](computer18.png)

中断处理以从硬件发出的请求为条件，使程序的流程产生分支，因此可以说它是一种特殊的条件分支。可是，在编写的程序中并不需要编写有关中断代理的代码。因为处理中断请求的程序，或是内置于被烧录在计算机ROM中的`BIOS`系统（Basic Input Output System,基本输入输出系统）中，或是内置于Windows等操作系统中。

### 4.7 特殊的程序流程-事件驱动
程序员经常用事件驱动的方式编写那些工作在GUI（Graphical User Interface，图形用户界面）环境中的应用程序。

通常把用户在应用程序中点击鼠标键或敲击键盘按键这样的操作称为`事件`（Event）。负责检测事件的是Windows。应用程序则根据事件的类型做出相应的处理。这种机制就是`事件驱动`。可以说事件驱动也是一种特殊的条件分支，它以从Windows送来的通知为条件，根据通知的内容决定程序下一步的流程。

`状态转化图`中有多个状态，反映了由于某种原因从某个状态转化到另一个状态的流程。

例如，图4.15所示的计算器应用程序就可以看作包含三个状态：“显示计算机结果”、“显示第一个输入的数”以及“显示第二个输入的数”。随着用户按下不同种类的键，状态也会发生转变。

图4.15 Windows附带的计算器应用程序

![](computer19.png)

图4.16 计算器应用程序的状态转化图

![](computer20.png)

表4.2 计算机程序的状态转化表的例子

![](computer21.png)

程序的流程还是只有顺序执行、条件分支和循环三种。这一点没有改变，其中的顺序执行是最基本的程序流程，这是因为CPU中的PC寄存器的值会自动更新，条件分支和循环，在高级语言中用程序块表示，在机器语言和汇编语言中用跳转指令表示，在硬件上是通过把PC寄存器的值设为要跳转到的目的地的内存地址来实现的。

## 第5章 与算法成为好朋友的七个要点
### 要点1：算法中解决问题的步骤是明确且有限的
算法就是“把解决问题的步骤无一遗漏地用文字或图表示出来”。要是把这时的“用文字或图表示”替换为“用编程语言表达”，算法就变成了程序。

图5.1 在中学学的求解最大公约数的方法

![](computer22.png)

步骤1的“用2整除12和42”和步骤2“用3整除6和21”，是怎么知道要这样做的呢？寻找能够整除的数字的方法，在这两步中并没有体现。步骤3“没有能同时带队和7的除数”，又是怎么知道的呢？

这些都是凭借人类的判断。在解决问题的步骤中，有了与直觉相关的因素，就不是算法了，既然不是算法，也就不能用程序表示了。

### 要点2：计算机不靠直觉而是机械地解决问题
计算机所执行的由程序表示的算法必须是由机械的步骤所构成。所谓`“机械的步骤“`就是不用动任何脑筋，只要按照这个步骤做就一定能完成的意思。

辗转相除法（又称欧几里德算法）就是一个机械地求解最大公约数问题的算法，在辗转相除法中分为使用除法运算和使用减法运算两种方法。步骤如图5.2所示。

图5.2 根据辗转相除法求解最大公约数的方法

![](computer23.png)

### 要点3：了解并应用典型算法
表5.1 主要的典型算法

名称 | 用途
---|---
辗转相除法 | 求解最大公约数
埃拉托斯特尼筛选法 | 判定素数
顺序查找 | 检索数据
二分查找 | 检索数据
哈希查找 | 检索数据
冒泡排序 | 数据排序
快速排序 | 数据排序

## 第6章 与数据结构成为好朋友的七个要点
### 要点1：了解内存和变量的关系
计算机所处理的数据都存储在了被称为`内存`的`IC（Integrated Circuit，集成电路）`中。在一般的个人计算机中，内存内部被分割成了若干个数据存储单元，每个单元可存储8比特的数据（8比特=1字节）。为了区分各个单元，每个单元都被分配了一个编号，这个编号被称为`“地址”`（门牌号码）。

因为依靠指定地址的方式编写程序很麻烦，所以在C、Java、BASIC等几乎所有编程语言中，都是使用`变量`把数据存储在内存中或从内存中把数据读出来。

```c
char a;   /*定义变量*/
a=123;     /*把数据存入变量*/
```

对于程序员来说，并不需要知道变量a被存储到内存空间中的哪个地址上。因为当程序运行时是由操作系统从尚未使用的内存空间中划分出一部分分配给变量a的。

图6.1 内存的物理结构以及它与程序的关系

![](computer24.png)

### 要点2：了解作为数据结构基础的数组
通过使用数组，既可以同时定义出多个变量，又可以提高编写程序的效率。`数组`实际上是为了存储多个数据而在内存上集中分配出的一块内存空间，并且为这块空间整体赋予了一个名字。可以通过在`[`和`]`之间指定序号（`索引`）的方式分别访问数组内的各块内存空间。

图6.2 数组反映了内存物理结构本身

![](computer25.png)

### 要点3：了解数组的应用 – 作为典型算法的数据结构
```c
for (i=0;i<1000;i++){
```

通常把像变量i这样的用于记录循环次数的变量称为循环计数器（Loop Counter）。数组之所以方便，就是因为可以把循环计数器的值与数组的索引对应起来使用（如图6.3所示）

图6.3 把循环计数器的值和数组的索引对应起来

![](computer26.png)

### 要点4：了解并掌握典型数据结构的类型和概念
表6.1 主要的典型数据结构

名称 | 数据结构的特征
---|--------
栈 | 把数据堆积的像山一样
队列 | 把数据排成一队
链表 | 可以任意地改变数据的排列顺序
二叉树 | 把数据分为两路排列

### 要点5：了解栈和队列的实现方法
代码清单6.6 使用数组、栈顶指针、入栈函数和出栈函数实现栈

```c
char Stack[100];           /*作为栈本质的数组*/
char StackPointer=0;       /*栈顶指针*/

/*入栈函数*/
void Push(char Data){
  /*把数据存储到栈顶指针所指的位置上*/
  Stack[StackPointer]=Data;

  /*更新栈顶指针的值*/
  StackPointer++;
}

/*出栈函数*/
char Pop(){
  /*更新栈顶指针的值*/
  StackPointer--;
  
  /*把数据从栈顶指针所指的位置中取出来*/
  return Stack[StackPointer];
}
```

代码清单6.7 使用一个数组、两个变量和两个函数实现队列

```c
char Queue[100];             /*作为队列本质的数组*/
char SetIndex=0;             /*标识数据存储位置的索引*/
char GetIndex=0;             /*标识数据读取位置的索引*/

/*存储数据的函数*/
void Set(char Data){
  /*存入数据*/
  Queue[SetIndex]=Data;

  /*更新标识数据存储位置的索引*/
  SetIndex++;

  /*如果已到达数组的末尾则折回到开头*/
  if (SetIndex>=100){
     SetIndex=0;
  }
}

/*读取数据的函数*/
char Get(){
  char Data;
  /*读出数据*/
  Data=Queue[GetIndex];

  /*更新标识数据读取位置的索引*/
  GetIndex++;

  /*如果已到达数组的末尾则折加开头*/
  if (GetIndex>=100){
    GetIndex=0;
  }
    
  /*返回读出的数据*/
  return Data;
}
```

### 要点6：了解结构体的组成
所谓`结构体`，就是把若干个数据项汇集到一处并赋予其名字后所形成的一个整体。

代码清单6.8 结构体汇集了若干个数据项

```c
struct TestResult{
  char Chinese;       /*语文成绩*/
  char Math;          /*数学成绩*/
  char English;       /*英语成绩*/
}
```

代码清单 6.9 结构体的使用方法

```c
struct TestResult xiaoming;   /*把结构体作为数据类型定义变量*/
xiaoming.Chinese=80;          /*为成员数据Chinese赋值*/
xiaoming.Math=90;             /*为成员数据Math赋值*/
xiaoming.English=100;         /*为成员数据English赋值*/
```

图6.10 结构体数组的示意图

![](computer27.png)


